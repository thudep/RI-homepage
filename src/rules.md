# 辐射成像大赛比赛规则

本比赛的核心目的是对提供的数据集进行腹部器官医学图像分割，根据分割准确度进行评分。

## 任务要求

参赛选手可使用 Pytorch 完成模型训练，在给出代码的基础上进行修改（或者直接重写，亦可不用神经网络~），实现一个可以输入原始 CT 图像，得到对应器官分割标签图的神经网络模型。并将评分集的原始图片（后缀为 `.nii.gz` ）作为输入，得到与标签图格式完全相同的图像（后缀为 `.nii.gz` ），最终得分将通过其与评分集的真实标签图做对比得到。

选手还应完成一份简要的比赛报告（参考给出的 `report.md` 模版），重点说明所需的额外运行环境要求和本队的优化修改思路。

## 提交方式

本比赛在[清华大学gitlab](https://git.tsinghua.edu.cn/)上进行，选手修改代码后，进行 `git push` 操作即可自动运行评分 ci ，无需其他方式提交。

## 评分标准

完整的评分代码见 `grade.py` 文件，选手**不能修改**此文件，如果发现此代码存在 bug ，请向赛事组委会反馈，组委会将统一说明并修改。

### one-hot 编码

对于分割好的 `3` 维标签图像，会转化为 `4` 维的 `numpy` 数组，其中前三个维度表示图像的空间分辨率，第四个维度对应 `15` 个不同的器官分割通道，按照 [one-hot 编码](https://en.wikipedia.org/wiki/One-hot)填充数据。

通道索引与器官标签的映射关系为：通道`0`对应标签`1`（即第一个器官），通道`1`对应标签`2`（依此类推），直至通道`14`对应标签`15`（第十五个器官）。每个通道为严格的二值化分割结果，即仅包含`0`和`1`两种数值——数值`1`表示该像素被判定为对应器官区域，`0`则表示非该器官区域。

### Dice 系数

评分采用 Dice 相似系数（Dice Similarity Coefficient, DSC）作为核心评价指标。对于每个器官独立计算其 Dice 分数，具体计算公式为：

$$
\text{Dice}_p = \frac{2 \times \sum_{i=1}^L \sum_{j=1}^W \sum_{k=1}^H \mathbb{I}\left( y_{\text{pred}}^{(p)} (i,j,k) = 1 \cap y_{\text{true}}^{(p)} (i,j,k) = 1 \right)}{\sum_{i=1}^L \sum_{j=1}^W \sum_{k=1}^H \mathbb{I}\left( y_{\text{pred}}^{(p)} (i,j,k) = 1 \right) + \sum_{i=1}^L \sum_{j=1}^W \sum_{k=1}^H \mathbb{I}\left( y_{\text{true}}^{(p)} (i,j,k) = 1 \right) + \varepsilon}
$$

式中：

- $p \in \{1, 2, ..., 15\}$ 表示器官编号
- $L \times W \times H$ 为图像分辨率（即`img_size`）
- $\mathbb{I}(\cdot)$ 为指示函数，条件满足时取 $1$ ，否则为 $0$ 
- $\varepsilon = 10^{-7}$ 为平滑项，用于避免分母为零的情况

背景区域（标签`0`）不参与任何器官的Dice计算。最终得分为15个器官Dice分数的宏平均（算术平均），计算结果保留四位小数（如0.8573）。针对特殊情形设定补充规则：当某器官在真实标注中不存在（即真实掩膜全为`0`）且预测结果也全为`0`时，该器官Dice分数记为`1`；若真实标注存在但预测结果全为`0`，则按正常公式计算（此时分子为`0`，分母非零）。评分系统将对所有测试样本独立计算后取平均，确保评估结果的客观性。

最终得分为所有器官的得分平均值，并转化为以 100 为满分。
